// Changer l'URL de l'API ici
const host = 'https://localhost:8000';


var taskInput=document.getElementById("new-task"),taskDescr=document.getElementById("text-task"),addButton=document.querySelector(".popup button"),incompleteTaskHolder=document.getElementById("incomplete-tasks"),completedTasksHolder=document.getElementById("completed-tasks"),taskName=document.getElementById("task-name"),taskDate=document.getElementById("task-date"),taskDescription=document.getElementById("task-description"),taskStatus=document.getElementById("task-status"),createNewTaskElement=function(e,t,a=!1){var n=document.createElement("li");n.setAttribute("data-id",e);var s=document.createElement("input");a&&(s.checked=!0);var o=document.createElement("label"),d=document.createElement("input"),i=document.createElement("button"),l=document.createElement("button"),c=document.createElement("button");return o.innerText=t,s.type="checkbox",d.type="text",i.innerText="Edit",i.className="edit",l.innerText="Voir",l.className="show",c.innerText="Suppr.",c.className="delete",n.appendChild(s),n.appendChild(o),n.appendChild(d),n.appendChild(l),n.appendChild(i),n.appendChild(c),n},addTask=function(e,t,a){var n=createNewTaskElement(e,t,a);(a?completedTasksHolder:incompleteTaskHolder).appendChild(n),bindTaskEvents(n,a?taskIncomplete:taskCompleted),taskInput.value="",taskDescr.value=""},showTask=function(){let e=this.parentNode.getAttribute("data-id");fetch(host+"/api/tasks/"+e).then(e=>e.json()).then(e=>{if(!("title"in e&&"done"in e&&"id"in e&&"createdAt"in e&&"description"in e))throw new Error("champ id, title, createdAt, descripton ou done manquant");showPopup("popup-task"),taskName.textContent=e.title,taskStatus.textContent=e.done?"Terminée":"À faire",taskDate.textContent=new Date(e.createdAt).toLocaleString(),taskDescription.textContent=e.description.length>0?e.description:"Pas de description"}).catch(t=>{alert("Route GET /api/tasks/"+e+" invalide : "+t.message)})},editTask=function(){var e=this.parentNode,t=e.querySelector("input[type=text]"),a=e.querySelector("label");e.classList.contains("editMode")?editTaskAPI(e.getAttribute("data-id"),e.getElementsByTagName("input")[0].checked,t.value,()=>{a.innerText=t.value}):t.value=a.innerText,e.classList.toggle("editMode")},deleteTask=function(){var e=this.parentNode,t=e.parentNode;fetch(host+"/api/tasks/"+e.getAttribute("data-id"),{method:"DELETE"}).then(a=>{if(a.status>=300)throw new Error("erreur "+a.status);t.removeChild(e)}).catch(t=>{alert("Route DELETE /api/tasks/"+e.getAttribute("data-id")+" invalide : "+t.message)})},taskCompleted=function(){var e=this.parentNode;editTaskAPI(e.getAttribute("data-id"),!0,e.getElementsByTagName("label")[0].textContent,()=>{completedTasksHolder.appendChild(e),bindTaskEvents(e,taskIncomplete)})},taskIncomplete=function(){var e=this.parentNode;editTaskAPI(e.getAttribute("data-id"),!1,e.getElementsByTagName("label")[0].textContent,()=>{incompleteTaskHolder.appendChild(e),bindTaskEvents(e,taskCompleted)})};let editTaskAPI=(e,t,a,n)=>{fetch(host+"/api/tasks/"+e,{method:"PUT",body:JSON.stringify({id:parseInt(e),title:a,done:t})}).then(e=>e.json()).then(e=>{n()}).catch(t=>{alert("Route PUT /api/tasks/"+e+" invalide : "+t.message)})};var createTask=function(){fetch(host+"/api/tasks/",{method:"POST",body:JSON.stringify({title:taskInput.value,description:taskDescr.value})}).then(e=>e.json()).then(e=>{addTask(e.id,taskInput.value,!1),showPopup("popup",!1)}).catch(e=>{alert("Route POST /api/tasks invalide : "+e.message)})};addButton.addEventListener("click",createTask);for(var bindTaskEvents=function(e,t){var a=e.querySelector("input[type=checkbox]"),n=e.querySelector("button.edit"),s=e.querySelector("button.show"),o=e.querySelector("button.delete");s.onclick=showTask,n.onclick=editTask,o.onclick=deleteTask,a.onchange=t},i=0;i<incompleteTaskHolder.children.length;i++)bindTaskEvents(incompleteTaskHolder.children[i],taskCompleted);for(i=0;i<completedTasksHolder.children.length;i++)bindTaskEvents(completedTasksHolder.children[i],taskIncomplete);function showPopup(e="popup",t=!0){document.getElementsByClassName(e)[0].style.display=t?"block":"none",document.getElementById("overlay").style.display=t?"block":"none"}fetch(host+"/api/tasks/").then(e=>e.json()).then(e=>{e.forEach(e=>{if(!("title"in e&&"done"in e&&"id"in e))throw new Error("champ id, title ou done manquant");addTask(e.id,e.title,e.done)})}).catch(e=>{alert("Route GET /api/tasks invalide : "+e.message)}),document.getElementById("add-task").addEventListener("click",()=>showPopup()),document.getElementById("overlay").addEventListener("click",()=>{showPopup("popup",!1),showPopup("popup-task",!1),taskName.textContent="",taskDescription.textContent="",taskDate.textContent="",taskStatus.textContent=""});